<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #141414;
      color: white;
      text-align: center;
    }
    header {
      background-color: #000;
      padding: 20px 0;
    }
    .container {
      width: 80%;
      margin: 20px auto;
      background-color: #222;
      padding: 20px;
      border-radius: 10px;
    }
    input, button {
      padding: 10px;
      margin: 10px;
      width: 30%;
    }
    button {
      background-color: #e50914;
      color: white;
      border: none;
      cursor: pointer;
    }
    .user-list {
      list-style-type: none;
      padding: 0;
    }
    .user-item {
      background-color: #333;
      padding: 10px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
    }
    .admin-section {
      display: none; /* Nascondi per utenti non admin */
    }
  </style>
</head>
<body>
  <header>
    <h1>Dashboard</h1>
    <button id="logoutButton">Logout</button>
  </header>

  <div class="container">
    <h2>Gestione Utenti</h2>
    <div id="adminSection" class="admin-section">
      <input type="text" id="newUsername" placeholder="Nuovo Username" />
      <input type="password" id="newPassword" placeholder="Nuova Password" />
      <button id="createUserButton">Crea Utente</button>

      <h3>Lista Utenti</h3>
      <ul id="usersList" class="user-list"></ul>
    </div>
  </div>

  <script>
    // Funzione per ottenere gli utenti dal localStorage
    function getUsers() {
      return JSON.parse(localStorage.getItem('users')) || [];
    }

    // Funzione per salvare gli utenti nel localStorage
    function saveUsers(users) {
      localStorage.setItem('users', JSON.stringify(users));
    }

    // Funzione per ottenere un cookie
    function getCookie(name) {
      const cookies = document.cookie.split('; ');
      for (let cookie of cookies) {
        const [key, value] = cookie.split('=');
        if (key === name) return value;
      }
      return null;
    }

    // Funzione per caricare gli utenti e visualizzarli
    function loadUsers() {
      const users = getUsers();
      const username = getCookie('username'); // Prende l'username dal cookie
      const currentUser = users.find(u => u.username === username);

      const adminSection = document.getElementById('adminSection');

      // Solo gli admin possono vedere la gestione utenti
      if (currentUser && currentUser.admin) {
        adminSection.style.display = 'block'; // Mostra la gestione utenti per admin
      } else {
        adminSection.style.display = 'none'; // Nascondi per utenti non admin
      }
    }

    // Funzione per creare un nuovo utente
    document.getElementById('createUserButton').addEventListener('click', function() {
      const username = document.getElementById('newUsername').value;
      const password = document.getElementById('newPassword').value;

      if (username && password) {
        const users = getUsers();
        const newUser = { username: username, password: password, admin: false }; // I nuovi utenti non sono admin
        users.push(newUser);
        saveUsers(users);
        loadUsers();  // Ricarica la lista utenti
      } else {
        alert('Compila tutti i campi!');
      }
    });

    // Funzione di logout
    document.getElementById('logoutButton').addEventListener('click', function() {
      document.cookie = 'username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/';
      alert('Logout effettuato!');
      window.location.href = 'login.html';
    });

    // Carica gli utenti all'avvio
    loadUsers();
  </script>
</body>
</html>
